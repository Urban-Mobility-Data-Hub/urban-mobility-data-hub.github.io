{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Inicio","text":"<p>    Urban Mobility Data Hub es un ecosistema de datos abierto y seguro para la movilidad urbana    que pretende facilitar la interoperabilidad promoviendo el uso de est\u00e1ndares europeos y la soberan\u00eda del dato.   Proporciona una base abierta para el desarrollo de iniciativas de movilidad inteligente, impulsando la colaboraci\u00f3n entre administraciones, empresas e instituciones de investigaci\u00f3n y la adopci\u00f3n de soluciones sostenibles y basadas en datos.   Objetivos  <p>Facilitar la coordinaci\u00f3n de veh\u00edculos aut\u00f3nomos para el transporte de pasajeros y la distribuci\u00f3n de mercanc\u00edas mediante algoritmos avanzados basados en inteligencia artificial.</p> <p>Optimizar el uso y mantenimiento de infraestructuras urbanas inteligentes, mejorando la eficiencia operativa y contribuyendo a la sostenibilidad medioambiental.</p> Documentaci\u00f3n Arquitectura <p>Visi\u00f3n general de la infraestructura y sus componentes principales.</p> Gu\u00eda de despliegue <p>Como desplegar el entorno paso a paso.</p> Uso del Dataspace <p>Publicar datasets, negociar y consumir datos dentro del entorno del Dataspace.</p> Seguridad y autenticaci\u00f3n <p>Gesti\u00f3n de accesos y control de identidades con Keycloak y OIDC y control de acceso por pol\u00edticas.</p> Marketplace <p>Publica, descubre y comparte activos de datos en el ecosistema.</p> Onboarding <p>Como formar parte del espacio de datos.</p> <p>     2025 Urban Mobility Data Hub \u2014 Powered by      ValgrAI and      VRAIN </p> <p></p>"},{"location":"about/","title":"Sobre el proyecto","text":"<p>El Urban Mobility Data Hub (UMDH) es una iniciativa abierta para crear un espacio de datos FIWARE orientado a la movilidad urbana.</p>"},{"location":"about/#fundamentos","title":"Fundamentos","text":"<ul> <li>Basado en FIWARE, GAIA-X y IDS (International Data Spaces).</li> <li>Utiliza tecnolog\u00edas como EDC Connectors, TM Forum APIs y Orion-LD Context Broker.</li> <li>Permite compartir datos entre entidades p\u00fablicas y privadas garantizando la soberan\u00eda y trazabilidad.</li> </ul>"},{"location":"about/#colaboradores","title":"Colaboradores","text":"<p>El proyecto se desarrolla bajo el ecosistema ValgrAI, en colaboraci\u00f3n con la FIWARE Foundation y comunidades de datos europeas.</p>"},{"location":"apis/","title":"Apis","text":""},{"location":"apis/#apis-principales","title":"APIs principales","text":"API Rol Responsabilidad Ejemplos de Endpoints Data API Gesti\u00f3n de data assets (recursos reales de datos). Registrar, exponer y servir datos compartidos dentro del Dataspace.Incluye:\u2022 Entidades NGSI-LD, datasets o flujos de datos.\u2022 Acceso a los endpoints reales.\u2022 CRUD de assets (crear, consultar, actualizar, eliminar).\u2022 Servicios de descubrimiento por ID o tipo de recurso. <code>/data/assets</code> \u2192 lista de datasets disponibles.<code>/data/entities</code> \u2192 acceso a datos NGSI-LD. Contract API Gesti\u00f3n de ofertas y contratos de uso de los datos. Orquestar el ciclo de vida de los data offerings desde su definici\u00f3n hasta la negociaci\u00f3n.Incluye:\u2022 ProductSpecification, ProductOffering y Agreement (TM Forum).\u2022 Registro de ofertas disponibles y condiciones.\u2022 Iniciar, aceptar o rechazar negociaciones.\u2022 Generar Data Agreements y vincularlos a Data Assets. <code>/contract/offerings</code> \u2192 lista de ofertas.<code>/contract/agreements</code> \u2192 contratos activos.<code>/contract/negotiations</code> \u2192 gesti\u00f3n de negociaciones. Authorization API Control de acceso y aplicaci\u00f3n de pol\u00edticas (OPA/PDP). Evaluar si una solicitud cumple las condiciones de seguridad y contrato.Incluye:\u2022 Integraci\u00f3n con OPA (Open Policy Agent).\u2022 Evaluaci\u00f3n de pol\u00edticas (PDP/PIP/PAP).\u2022 Validaci\u00f3n de tokens OIDC y claims.\u2022 Env\u00edo de decisiones \u201cpermit/deny\u201d a APISIX. <code>/authz/evaluate</code> \u2192 recibe token y contexto, devuelve permit/deny. Authentication API Identidad y emisi\u00f3n de tokens o credenciales. Gestionar la autenticaci\u00f3n de usuarios, aplicaciones o conectores.Incluye:\u2022 Integraci\u00f3n con Keycloak (OIDC, OAuth2).\u2022 Emisi\u00f3n y validaci\u00f3n de tokens JWT.\u2022 Verifiable Credentials (OID4VC).\u2022 Endpoints de login, refresh, revoke. <code>/authn/token</code> \u2192 login.<code>/authn/validate</code> \u2192 validar token."},{"location":"architecture/","title":"Architecture","text":"<p>arquitectura kubernetes</p>"},{"location":"contact/","title":"Contacto","text":"<p>\ud83d\udccd Urban Mobility Data Hub Proyecto impulsado por ValgrAI</p> <p>\ud83d\udce7 cristian.borgo\u00f1oz@valgrai.eu \ud83c\udf10 https://urban-mobility-data-hub.github.io</p> <p>GitHub: urban-mobility-data-hub</p>"},{"location":"datos/","title":"Datos","text":""},{"location":"datos/#acceso-protegido-mediante-apisix","title":"Acceso protegido mediante APISIX","text":"<p>Los endpoints de datos del dataspace est\u00e1n protegidos por el API Gateway (APISIX), que act\u00faa como Policy Enforcement Point (PEP). Esto significa que cualquier operaci\u00f3n sobre datos (lectura o escritura) requiere un token OIDC v\u00e1lido emitido por el sistema de autenticaci\u00f3n.</p>"},{"location":"datos/#operaciones-disponibles-en-ngsi-ldv1entities","title":"Operaciones disponibles en <code>/ngsi-ld/v1/entities</code>","text":"<p>El Context Broker (Scorpio) implementa el est\u00e1ndar NGSI-LD, lo que permite gestionar entidades sem\u00e1nticas con operaciones CRUD (Create, Read, Update, Delete). Todas estas llamadas pueden hacerse a trav\u00e9s del gateway APISIX, autenticadas mediante Bearer Token OIDC.</p>"},{"location":"datos/#obtener-un-token-de-acceso-oid4vp","title":"Obtener un token de acceso (OID4VP)","text":"<p>Antes de interactuar con los datos, es necesario obtener un Access Token autenticado mediante el flujo OID4VP (OpenID for Verifiable Presentations).</p> <p>Ejemplo de obtenci\u00f3n de token:</p> <pre><code>    export ACCESS_TOKEN=$(./doc/scripts/get_access_token_oid4vp.sh \\\n    http://mp-data-service.127.0.0.1.nip.io:8080 \\\n    $OPERATOR_CREDENTIAL \\\n    operator)\n</code></pre>"},{"location":"datos/#crear-una-entidad-create","title":"Crear una entidad (Create)","text":"<p>Una vez obtenido el token, puedes crear una entidad NGSI-LD dentro del Scorpio Broker, a trav\u00e9s del endpoint protegido de APISIX:</p> <pre><code>    curl -X POST http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities \\\n    -H 'Accept: */*' \\\n    -H 'Content-Type: application/json' \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n    -d '{\n        \"id\": \"urn:ngsi-ld:K8SCluster:fancy-marketplace\",\n        \"type\": \"K8SCluster\",\n        \"name\": {\n        \"type\": \"Property\",\n        \"value\": \"Fancy Marketplace Cluster\"\n        },\n        \"numNodes\": {\n        \"type\": \"Property\",\n        \"value\": \"3\"\n        },\n        \"k8sVersion\": {\n        \"type\": \"Property\",\n        \"value\": \"1.26.0\"\n        }\n    }'\n</code></pre>"},{"location":"datos/#consultar-todas-las-entidades-read-all","title":"Consultar todas las entidades (Read All)","text":"<pre><code>    curl -X GET http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities \\\n    -H \"Accept: application/json\" \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre> <p>Devuelve una lista de todas las entidades visibles para el usuario autenticado (seg\u00fan las pol\u00edticas aplicadas).</p>"},{"location":"datos/#consultar-una-entidad-especifica-read-by-id","title":"Consultar una entidad espec\u00edfica (Read by ID)","text":"<pre><code>    curl -X GET http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities/urn:ngsi-ld:K8SCluster:fancy-marketplace \\\n    -H \"Accept: application/json\" \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre> <p>Obtiene los detalles de una entidad concreta, incluyendo sus propiedades y relaciones.</p>"},{"location":"datos/#consultar-por-tipo-o-atributos-query","title":"Consultar por tipo o atributos (Query)","text":"<pre><code>    curl -G http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities \\\n    -H \"Accept: application/json\" \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n    --data-urlencode 'type=K8SCluster'\n</code></pre> <p>Puedes usar par\u00e1metros como:</p> <ul> <li> <p>type \u2014 filtra por tipo de entidad.</p> </li> <li> <p>q \u2014 aplica condiciones sobre atributos (q=numNodes&gt;2).</p> </li> <li> <p>attrs \u2014 selecciona atributos espec\u00edficos.</p> </li> <li> <p>options=keyValues \u2014 devuelve un formato simplificado.</p> </li> </ul>"},{"location":"datos/#actualizar-atributos-update","title":"Actualizar atributos (Update)","text":"<pre><code>    curl -X PATCH http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities/urn:ngsi-ld:K8SCluster:fancy-marketplace/attrs \\\n    -H \"Content-Type: application/json\" \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n    -d '{\n        \"numNodes\": { \"type\": \"Property\", \"value\": 5 }\n    }'\n</code></pre> <p>Modifica uno o varios atributos de una entidad existente.</p>"},{"location":"datos/#eliminar-una-entidad-delete","title":"Eliminar una entidad (Delete)","text":"<pre><code>    curl -X DELETE http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/entities/urn:ngsi-ld:K8SCluster:fancy-marketplace \\\n    -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre> <p>Elimina la entidad indicada del Context Broker (si la pol\u00edtica de acceso lo permite).</p>"},{"location":"datos/#suscripciones-ngsi-ld-subscriptions","title":"Suscripciones (NGSI-LD Subscriptions)","text":"<p>Las suscripciones permiten recibir notificaciones autom\u00e1ticas cuando una entidad del Context Broker (Scorpio) cambia, cumple ciertas condiciones o deja de existir. Cada suscripci\u00f3n define:</p> <ul> <li>Qu\u00e9 entidades o tipos quiere observar.  </li> <li>Qu\u00e9 condiciones deben cumplirse.  </li> <li>A qu\u00e9 endpoint se deben enviar las notificaciones.</li> </ul>"},{"location":"datos/#crear-una-suscripcion","title":"Crear una suscripci\u00f3n","text":"<pre><code>curl -X POST http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/subscriptions \\\n  -H \"Content-Type: application/ld+json\" \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -d '{\n    \"id\": \"urn:ngsi-ld:Subscription:K8SClusterUpdates\",\n    \"type\": \"Subscription\",\n    \"entities\": [{\n      \"type\": \"K8SCluster\"\n    }],\n    \"watchedAttributes\": [\"numNodes\"],\n    \"q\": \"numNodes&gt;2\",\n    \"notification\": {\n      \"endpoint\": {\n        \"uri\": \"http://consumer-service.127.0.0.1.nip.io:8080/notify\",\n        \"accept\": \"application/json\"\n      },\n      \"format\": \"normalized\"\n    },\n    \"throttling\": 5\n  }'\n</code></pre> <p>Qu\u00e9 hace este ejemplo:</p> <ul> <li> <p>Observa todas las entidades de tipo K8SCluster.</p> </li> <li> <p>Solo env\u00eda notificaciones si el atributo numNodes cambia y cumple numNodes&gt;2.</p> </li> <li> <p>Envia un POST al endpoint http://consumer-service.../notify.</p> </li> <li> <p>Usa throttling: 5 para no enviar m\u00e1s de una notificaci\u00f3n cada 5 s.</p> </li> </ul>"},{"location":"datos/#consultar-suscripciones-existentes","title":"Consultar suscripciones existentes","text":"<pre><code>curl -X GET http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/subscriptions \\\n  -H \"Accept: application/json\" \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre> <p>Devuelve todas las suscripciones visibles para el usuario autenticado.</p>"},{"location":"datos/#consultar-una-suscripcion-especifica","title":"Consultar una suscripci\u00f3n espec\u00edfica","text":"<pre><code>curl -X GET http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/subscriptions/urn:ngsi-ld:Subscription:K8SClusterUpdates \\\n  -H \"Accept: application/json\" \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre>"},{"location":"datos/#eliminar-una-suscripcion","title":"Eliminar una suscripci\u00f3n","text":"<pre><code>curl -X DELETE http://mp-data-service.127.0.0.1.nip.io:8080/ngsi-ld/v1/subscriptions/urn:ngsi-ld:Subscription:K8SClusterUpdates \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\"\n</code></pre>"},{"location":"datos/#notificaciones-al-consumidor","title":"Notificaciones al consumidor","text":"<p>Cuando se cumpla la condici\u00f3n definida, Scorpio enviar\u00e1 una notificaci\u00f3n al endpoint configurado:</p> <pre><code>{\n  \"id\": \"urn:ngsi-ld:K8SCluster:fancy-marketplace\",\n  \"type\": \"K8SCluster\",\n  \"numNodes\": { \"type\": \"Property\", \"value\": 4 },\n  \"observedAt\": \"2025-10-14T09:30:00Z\",\n  \"@context\": \"https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context.jsonld\"\n}\n</code></pre> <p>El servicio receptor (/notify) debe responder con 200 OK para confirmar la recepci\u00f3n.</p>"},{"location":"datos/#notas","title":"Notas","text":"<p>Todas las operaciones pasan por APISIX, que valida el token OIDC con Keycloak/Verifier.</p> <p>El Policy Engine (OPA) determina si el usuario tiene permiso para leer o modificar las entidades solicitadas.</p> <p>Por defecto todo es 403 Unathorized, si no se crea una pol\u00edtica establecida que permita hacer algo.</p>"},{"location":"deploy-guide/","title":"Gu\u00eda de Despliegue del Dataspace","text":"<p>Esta gu\u00eda explica c\u00f3mo desplegar el entorno del Dataspace paso a paso, tanto en local como en un entorno de pruebas o producci\u00f3n.</p>"},{"location":"deploy-guide/#requisitos-del-sistema","title":"Requisitos del sistema","text":"<p>Dado que el despliegue local instala 2 instancias de conector y un trust-anchor, se recomienda utilizar una m\u00e1quina lo suficientemente potente. Aunque 16 GB de RAM podr\u00edan ser suficientes, se aconseja disponer de m\u00e1s de 24 GB. El despliegue se ha construido y probado en Ubuntu, aunque la mayor\u00eda de las dem\u00e1s distribuciones de Linux tambi\u00e9n deber\u00edan funcionar.</p>"},{"location":"deploy-guide/#dependencias-necesarias","title":"Dependencias necesarias","text":"<p>El despliegue local intenta estar lo m\u00e1s desacoplado posible del sistema anfitri\u00f3n para reducir los requisitos, pero aun as\u00ed necesita los siguientes programas:</p> <ul> <li>Maven </li> <li>Java Development Kit (JDK) \u2014 al menos versi\u00f3n 17 </li> <li>Docker</li> </ul>"},{"location":"deploy-guide/#herramientas-recomendadas","title":"Herramientas recomendadas","text":"<p>Para interactuar con el sistema, tambi\u00e9n son \u00fatiles las siguientes herramientas:</p> <ul> <li>kubectl </li> <li>curl </li> <li>jq </li> <li>yq</li> </ul>"},{"location":"deploy-guide/#despliegue-local","title":"Despliegue local","text":"<p>Clonar el repositorio:</p> <pre><code>   git clone https://github.com/urban-mobility-data-hub/local-dataspace.git\n   cd local-dataspace\n</code></pre> <p>Desplegar el dataspace:</p> <pre><code>    mvn clean deploy -Plocal\n</code></pre> <p>A\u00f1adir el contexto a KUBECONFIG:</p> <pre><code>    export  KUBECONFIG=$(pwd)/target/k3s.yaml\n</code></pre> <p>Ver despliegue en tiempo real:</p> <pre><code>    watch kubectl get all --all-namespaces\n</code></pre>"},{"location":"onboarding/","title":"Conectar al dataspace","text":""},{"location":"onboarding/#conectar-al-dataspace-onboarding","title":"Conectar al Dataspace (Onboarding)","text":"<p>El proceso de conexi\u00f3n al dataspace define c\u00f3mo un nuevo participante se incorpora al ecosistema de intercambio de datos de forma segura, confiable y verificable.</p>"},{"location":"onboarding/#tipos-de-participantes","title":"Tipos de participantes","text":"Tipo Descripci\u00f3n Requisitos Provider Organizaci\u00f3n que ofrece activos de datos (data assets) a otros participantes del dataspace. \u2022 Disponer de informaci\u00f3n corporativa verificada (nombre legal, dominio, CIF, etc.).\u2022 Desplegar su propio Provider connector.\u2022 Obtener una Verifiable Credential (VC) emitida por el VC Issuer.\u2022 Registrar su endpoint y metadatos en el Cat\u00e1logo del Dataspace. Consumer Entidad que desea consumir activos de datos ofrecidos por otros participantes. \u2022 Obtener su VC de identidad emitida por el VC Issuer.\u2022 No necesita desplegar infraestructura local: puede interactuar a trav\u00e9s de la Authorization API o portales del nodo."},{"location":"onboarding/#flujo-de-incorporacion","title":"Flujo de incorporaci\u00f3n","text":"<p>El proceso de onboarding es distinto seg\u00fan el tipo de participante. A continuaci\u00f3n se describen ambos flujos de incorporaci\u00f3n.</p>"},{"location":"onboarding/#onboarding-de-consumer","title":"Onboarding de Consumer","text":"<p>Antes de poder consumir datos dentro del dataspace, la organizaci\u00f3n consumidora debe estar registrada en la Trusted Issuers List del proveedor, de modo que se reconozca como un emisor de confianza de Verifiable Credentials (VCs) que incluyan los claims necesarios (por ejemplo, ser comprador autorizado de productos en el conector del proveedor).</p> <p></p>"},{"location":"onboarding/#flujo-de-registro-del-consumer","title":"Flujo de registro del Consumer","text":"<ol> <li> <p>Solicitud de autenticaci\u00f3n    Un Legal Entity Appointed Representative (LEAR) de la organizaci\u00f3n consumidora accede al Dataspace onboarding service mediante una aplicaci\u00f3n de contrataci\u00f3n o portal web.    Este proceso comienza con la autenticaci\u00f3n a trav\u00e9s de su wallet, escaneando un c\u00f3digo QR.</p> </li> <li> <p>Solicitud de credenciales verificables    El Verifier del provider solicita al wallet del usuario las Verifiable Credentials necesarias que acrediten su identidad como LEAR y, eventualmente, otras VCs requeridas.</p> </li> <li> <p>Validaci\u00f3n del Verifier    El wallet comprueba que el Verifier pertenece a un participante leg\u00edtimo del dataspace y devuelve las VCs solicitadas.</p> </li> <li> <p>Verificaci\u00f3n de las credenciales    El Verifier comprueba que la VC del LEAR fue emitida por un participante de confianza del dataspace, y valida que las dem\u00e1s VCs tambi\u00e9n procedan de trusted issuers.</p> </li> <li> <p>Emisi\u00f3n de token    Si todas las verificaciones son correctas, el Verifier emite un token OIDC, que se devuelve al usuario.</p> </li> <li> <p>Registro de la organizaci\u00f3n    Usando el token obtenido, el LEAR invoca las TM Forum APIs del proveedor para registrar la organizaci\u00f3n consumidora dentro del conector y establecer los permisos de acceso correspondientes.</p> </li> <li> <p>Adici\u00f3n a la Trusted Issuers List    Una vez completado el registro, la organizaci\u00f3n queda incluida en la Trusted Issuers List local del proveedor como emisor de confianza de VCs con claims de tipo \u201cUSER\u201d.</p> </li> </ol>"},{"location":"onboarding/#onboarding-de-provider","title":"Onboarding de Provider","text":"<p>El onboarding de un Provider tiene como objetivo registrar oficialmente a la organizaci\u00f3n como participante de confianza dentro del dataspace y habilitar su infraestructura para ofrecer datos. A diferencia del Consumer, el Provider debe desplegar su propio Provider connector.</p> <p></p>"},{"location":"onboarding/#flujo-de-registro-del-provider","title":"Flujo de registro del provider","text":""},{"location":"onboarding/#1-verificacion-de-identidad-y-conformidad","title":"1. Verificaci\u00f3n de identidad y conformidad","text":"<ol> <li> <p>Preparaci\u00f3n de la autodescripci\u00f3n de la organizaci\u00f3n    La organizaci\u00f3n genera su Self-Description VC, un documento estructurado que describe su identidad, capacidades y pol\u00edticas de datos.</p> </li> <li> <p>Validaci\u00f3n de conformidad con Gaia-X    La Self-Description VC se env\u00eda al Gaia-X Digital Clearing House (GXDCH) para comprobar que cumple con las especificaciones de Gaia-X.    Si la validaci\u00f3n es correcta, el GXDCH emite una VC de conformidad, que se almacena en el wallet del LEAR (Legal Entity Appointed Representative) de la organizaci\u00f3n.</p> </li> <li> <p>Solicitud de autenticaci\u00f3n    El LEAR accede al portal de onboarding o a la Participant List App del dataspace.    Al escanear el c\u00f3digo QR de acceso con su wallet, el proceso se comunica con el Verifier del dataspace.</p> </li> <li> <p>Intercambio y validaci\u00f3n de credenciales    El Verifier solicita y valida las siguientes credenciales:</p> </li> <li>La VC del LEAR, que acredita al representante legal.  </li> <li>La Self-Description VC de la organizaci\u00f3n.  </li> <li>La VC de conformidad emitida por el GXDCH.  </li> </ol> <p>Si todas las VCs son v\u00e1lidas y emitidas por trusted issuers, el Verifier genera un token OIDC que autoriza el registro.</p> <ol> <li>Registro como participante de confianza    Con ese token, la aplicaci\u00f3n de onboarding invoca la API del Participant List Service, registrando la organizaci\u00f3n como Trusted Participant dentro del dataspace.</li> </ol>"},{"location":"onboarding/#2-despliegue-e-integracion-del-conector","title":"2. Despliegue e integraci\u00f3n del conector","text":"<p>Una vez registrada la organizaci\u00f3n, se habilita el entorno t\u00e9cnico que le permitir\u00e1 ofrecer datos a otros participantes.</p> <ol> <li>Despliegue del conector    La organizaci\u00f3n despliega su EDC Provider Connector (normalmente mediante Docker o Kubernetes) configurando:</li> <li>Endpoint p\u00fablico (p. ej. <code>https://provider-a.dataspace.local</code>)  </li> <li>Integraci\u00f3n con Keycloak (realm, client ID y secret)  </li> <li>Integraci\u00f3n con APISIX Gateway </li> <li> <p>Configuraci\u00f3n de pol\u00edticas y permisos en el Policy Engine</p> </li> <li> <p>Registro de activos y contratos    Una vez operativo, el conector puede publicar data assets y data offerings en el cat\u00e1logo del dataspace, estableciendo condiciones de acceso y contratos mediante las TM Forum APIs.</p> </li> </ol>"},{"location":"politicas/","title":"Pol\u00edticas y control de acceso","text":"<p>Las pol\u00edticas determinan qui\u00e9n puede acceder a qu\u00e9 datos y bajo qu\u00e9 condiciones. Dentro del dataspace, las pol\u00edticas se gestionan a trav\u00e9s del Policy Engine (OPA/ODRL-PAP) y se aplican a los contratos y assets publicados.</p>"},{"location":"politicas/#crear-una-politica-odrl","title":"Crear una pol\u00edtica ODRL","text":"<p>Ejemplo b\u00e1sico de pol\u00edtica de acceso (en formato JSON):</p> <pre><code>    {\n        \"@context\": \"https://www.w3.org/ns/odrl.jsonld\",\n        \"uid\": \"urn:policy:read-access\",\n        \"permission\": [{\n            \"target\": \"urn:asset:temperature-sensor\",\n            \"action\": \"use\",\n            \"constraint\": [{\n            \"leftOperand\": \"purpose\",\n            \"operator\": \"eq\",\n            \"rightOperand\": \"research\"\n            }]\n        }]\n    }\n</code></pre>"},{"location":"politicas/#registrar-la-politica","title":"Registrar la pol\u00edtica","text":"<pre><code>    curl -X POST http://localhost:8080/odrl-pap/policies \\\n    -H \"Content-Type: application/json\" \\\n    -d @policy.json\n</code></pre>"},{"location":"politicas/#consultar-politicas-activas","title":"Consultar pol\u00edticas activas","text":"<pre><code>    curl http://localhost:8080/odrl-pap/policies\n</code></pre>"},{"location":"politicas/#ejemplos-de-politicas","title":"Ejemplos de pol\u00edticas","text":""},{"location":"politicas/#permitir-a-todos-los-participantes-autenticados-leer-ofertas","title":"Permitir a todos los participantes autenticados leer ofertas","text":"<p>Esta pol\u00edtica permite que cualquier participante autenticado pueda consultar los ProductOfferings registrados en el cat\u00e1logo.</p> <pre><code>curl -s -X POST http://pap-provider.127.0.0.1.nip.io:8080/policy \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"@context\": {\n      \"odrl\": \"http://www.w3.org/ns/odrl/2/\",\n      \"tmf\": \"https://tmforum.org/\"\n    },\n    \"odrl:uid\": \"https://mp-operation.org/policy/common/offering\",\n    \"@type\": \"odrl:Policy\",\n    \"odrl:permission\": {\n      \"odrl:assigner\": {\"@id\": \"https://www.mp-operation.org/\"},\n      \"odrl:target\": {\n        \"@type\": \"odrl:AssetCollection\",\n        \"odrl:source\": \"urn:asset\",\n        \"odrl:refinement\": [{\n          \"@type\": \"odrl:Constraint\",\n          \"odrl:leftOperand\": \"tmf:resource\",\n          \"odrl:operator\": {\"@id\": \"odrl:eq\"},\n          \"odrl:rightOperand\": \"productOffering\"\n        }]\n      },\n      \"odrl:assignee\": {\"@id\": \"vc:any\"},\n      \"odrl:action\": {\"@id\": \"odrl:read\"}\n    }\n  }'\n</code></pre>"},{"location":"politicas/#permitir-a-los-representative-registrarse-como-cliente","title":"Permitir a los REPRESENTATIVE registrarse como cliente","text":"<p>Esta pol\u00edtica restringe el registro de organizaciones \u00fanicamente a usuarios con el rol REPRESENTATIVE.</p> <pre><code>curl -s -X POST http://pap-provider.127.0.0.1.nip.io:8080/policy \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"@context\": {\"odrl\": \"http://www.w3.org/ns/odrl/2/\", \"tmf\": \"https://tmforum.org/\"},\n    \"odrl:uid\": \"https://mp-operation.org/policy/common/selfRegistration\",\n    \"@type\": \"odrl:Policy\",\n    \"odrl:permission\": {\n      \"odrl:assigner\": {\"@id\": \"https://www.mp-operation.org/\"},\n      \"odrl:target\": {\n        \"@type\": \"odrl:AssetCollection\",\n        \"odrl:source\": \"urn:asset\",\n        \"odrl:refinement\": [{\n          \"@type\": \"odrl:Constraint\",\n          \"odrl:leftOperand\": \"tmf:resource\",\n          \"odrl:operator\": {\"@id\": \"odrl:eq\"},\n          \"odrl:rightOperand\": \"organization\"\n        }]\n      },\n      \"odrl:assignee\": {\n        \"@type\": \"odrl:PartyCollection\",\n        \"odrl:source\": \"urn:user\",\n        \"odrl:refinement\": {\n          \"@type\": \"odrl:LogicalConstraint\",\n          \"odrl:and\": [\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:role\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"REPRESENTATIVE\", \"@type\": \"xsd:string\"}\n            },\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:type\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"UserCredential\", \"@type\": \"xsd:string\"}\n            }\n          ]\n        }\n      },\n      \"odrl:action\": {\"@id\": \"tmf:create\"}\n    }\n  }'\n</code></pre>"},{"location":"politicas/#permitir-a-los-representative-crear-ordenes-de-productos","title":"Permitir a los REPRESENTATIVE crear \u00f3rdenes de productos","text":"<p>Esta pol\u00edtica autoriza la creaci\u00f3n de ProductOrders por parte de los usuarios con rol REPRESENTATIVE.</p> <pre><code>curl -s -X POST http://pap-provider.127.0.0.1.nip.io:8080/policy \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"@context\": {\"odrl\": \"http://www.w3.org/ns/odrl/2/\", \"tmf\": \"https://tmforum.org/\"},\n    \"odrl:uid\": \"https://mp-operation.org/policy/common/ordering\",\n    \"@type\": \"odrl:Policy\",\n    \"odrl:permission\": {\n      \"odrl:assigner\": {\"@id\": \"https://www.mp-operation.org/\"},\n      \"odrl:target\": {\n        \"@type\": \"odrl:AssetCollection\",\n        \"odrl:source\": \"urn:asset\",\n        \"odrl:refinement\": [{\n          \"@type\": \"odrl:Constraint\",\n          \"odrl:leftOperand\": \"tmf:resource\",\n          \"odrl:operator\": {\"@id\": \"odrl:eq\"},\n          \"odrl:rightOperand\": \"productOrder\"\n        }]\n      },\n      \"odrl:assignee\": {\n        \"@type\": \"odrl:PartyCollection\",\n        \"odrl:source\": \"urn:user\",\n        \"odrl:refinement\": {\n          \"@type\": \"odrl:LogicalConstraint\",\n          \"odrl:and\": [\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:role\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"REPRESENTATIVE\", \"@type\": \"xsd:string\"}\n            },\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:type\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"UserCredential\", \"@type\": \"xsd:string\"}\n            }\n          ]\n        }\n      },\n      \"odrl:action\": {\"@id\": \"tmf:create\"}\n    }\n  }'\n</code></pre>"},{"location":"politicas/#permitir-a-los-operators-leer-informacion-de-clusteres","title":"Permitir a los OPERATORS leer informaci\u00f3n de cl\u00fasteres","text":"<p>Esta pol\u00edtica da acceso de lectura a entidades del tipo K8SCluster \u00fanicamente a usuarios con credenciales de tipo OperatorCredential.</p> <pre><code>curl -s -X POST http://pap-provider.127.0.0.1.nip.io:8080/policy \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"@context\": {\"odrl\": \"http://www.w3.org/ns/odrl/2/\", \"ngsi-ld\": \"https://uri.etsi.org/ngsi-ld/\"},\n    \"odrl:uid\": \"https://mp-operation.org/policy/common/allowRead\",\n    \"@type\": \"odrl:Policy\",\n    \"odrl:permission\": {\n      \"odrl:assigner\": {\"@id\": \"https://www.mp-operation.org/\"},\n      \"odrl:target\": {\n        \"@type\": \"odrl:AssetCollection\",\n        \"odrl:source\": \"urn:asset\",\n        \"odrl:refinement\": [{\n          \"@type\": \"odrl:Constraint\",\n          \"odrl:leftOperand\": \"ngsi-ld:entityType\",\n          \"odrl:operator\": {\"@id\": \"odrl:eq\"},\n          \"odrl:rightOperand\": \"K8SCluster\"\n        }]\n      },\n      \"odrl:assignee\": {\n        \"@type\": \"odrl:PartyCollection\",\n        \"odrl:source\": \"urn:user\",\n        \"odrl:refinement\": {\n          \"@type\": \"odrl:LogicalConstraint\",\n          \"odrl:and\": [\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:role\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"OPERATOR\", \"@type\": \"xsd:string\"}\n            },\n            {\n              \"@type\": \"odrl:Constraint\",\n              \"odrl:leftOperand\": {\"@id\": \"vc:type\"},\n              \"odrl:operator\": {\"@id\": \"odrl:hasPart\"},\n              \"odrl:rightOperand\": {\"@value\": \"OperatorCredential\", \"@type\": \"xsd:string\"}\n            }\n          ]\n        }\n      },\n      \"odrl:action\": {\"@id\": \"odrl:read\"}\n    }\n  }'\n</code></pre> <p>Cada una de estas pol\u00edticas se almacena en el Policy Administration Point (PAP) y es evaluada en tiempo real por el Policy Decision Point (PDP) cuando un usuario intenta realizar una operaci\u00f3n sobre datos o recursos del dataspace.</p>"},{"location":"roadmap/","title":"Roadmap","text":"Fecha Hito Estado Octubre 2025 Despliegue local de entorno FIWARE \u2705 Completado Noviembre 2025 Integraci\u00f3n Keycloak + EDC \ud83d\udfe1 En curso Enero 2026 Publicaci\u00f3n API de datos abiertos \ud83d\udd1c Planificado Marzo 2026 Integraci\u00f3n con ecosistema CitComAI-Hub \ud83d\udd1c Planificado"},{"location":"security/","title":"Seguridad, autenticaci\u00f3n y autorizaci\u00f3n","text":"<p>El despliegue del Dataspace incluye un sistema de autenticaci\u00f3n y autorizaci\u00f3n basado en OIDC (OpenID Connect) y control de acceso por pol\u00edticas (PDP/PAP/PIP/PEP). Este sistema garantiza que solo los participantes autorizados puedan acceder a los servicios y datos publicados dentro del entorno.</p>"},{"location":"security/#componentes-principales","title":"Componentes principales","text":"Componente Funci\u00f3n Keycloak Servicio de identidad (IdP) basado en OIDC/OAuth2. Gestiona usuarios, clientes y roles, emite tokens de acceso y act\u00faa como punto central de autenticaci\u00f3n. Se integra con el VC Issuer para firmar credenciales verificables (OID4VC). VC Issuer Servicio responsable de emitir Verifiable Credentials (VCs) conforme al est\u00e1ndar OID4VC. Firma digitalmente las credenciales emitidas por el dataspace y asocia la identidad del emisor con su autoridad (por ejemplo, una organizaci\u00f3n o nodo operador). VC Verifier Servicio encargado de verificar la validez de las Verifiable Credentials presentadas por los participantes. Comprueba la firma, el emisor y el estado de revocaci\u00f3n para garantizar la confianza entre nodos. Policy Engine (PAP/PDP/PIP) M\u00f3dulo de autorizaci\u00f3n basado en pol\u00edticas (XACML/OPA). Eval\u00faa si una solicitud cumple las condiciones de acceso definidas en contratos y pol\u00edticas internas.\u2022 PAP: administra las pol\u00edticas.\u2022 PDP: toma decisiones (Permit/Deny).\u2022 PIP: obtiene informaci\u00f3n contextual (credenciales, contratos activos, roles)."},{"location":"security/#flujo-de-autenticacionautorizacion","title":"Flujo de autenticaci\u00f3n/autorizaci\u00f3n","text":"<ol> <li>El usuario o sistema consumidor accede a un servicio protegido (por ejemplo, una API expuesta por APISIX).  </li> <li>APISIX redirige la solicitud hacia Keycloak para autenticaci\u00f3n.  </li> <li>Una vez autenticado, Keycloak emite un token OIDC (JWT) firmado.  </li> <li>El token se adjunta a las peticiones posteriores (<code>Authorization: Bearer &lt;token&gt;</code>).  </li> <li>APISIX valida la firma del token mediante VC Verifier y extrae los claims del usuario.  </li> <li>Si las pol\u00edticas de acceso lo permiten, la solicitud se enruta al servicio correspondiente.</li> </ol>"},{"location":"security/#roles-basicos","title":"Roles b\u00e1sicos","text":"Rol Descripci\u00f3n Permisos principales USER Participante est\u00e1ndar del dataspace. Puede consumir datos, negociar contratos y acceder a los recursos para los que tenga permisos expl\u00edcitos. \u2022 Consultar datasets p\u00fablicos o contratados.\u2022 Iniciar solicitudes de negociaci\u00f3n.\u2022 Acceder a APIs protegidas con token OIDC v\u00e1lido. REPRESENTATIVE Usuario con autoridad para actuar en nombre de una organizaci\u00f3n o entidad dentro del dataspace. Gestiona ofertas, contratos y credenciales verificables. \u2022 Publicar data offerings y firmar contratos.\u2022 Emitir o verificar Verifiable Credentials asociadas a la organizaci\u00f3n.\u2022 Administrar pol\u00edticas de acceso de sus activos. OPERATOR Administrador del nodo o del entorno de despliegue. Supervisa la infraestructura, la configuraci\u00f3n de seguridad y los componentes del sistema. \u2022 Desplegar y mantener los servicios (Keycloak, APISIX, EDC, etc.).\u2022 Crear y gestionar realms, clientes y usuarios.\u2022 Monitorizar logs, m\u00e9tricas y pol\u00edticas globales."},{"location":"stack/","title":"Arquitectura","text":"<p>Urban Mobility Data Hub (UMDH) se construye sobre una arquitectura modular que implementa los principios de los Data Spaces, garantizando interoperabilidad, trazabilidad y control de acceso en el intercambio de datos.</p>"},{"location":"stack/#componentes-principales","title":"Componentes principales","text":"Componente Rol Campo en el diagrama Enlace VCVerifier Valida las Verifiable Credentials (VCs) y las intercambia por tokens de acceso. Verifier FIWARE/VCVerifier credentials-config-service Contiene la informaci\u00f3n sobre qu\u00e9 VCs son necesarias para acceder a cada servicio. PRP/PAP (autenticaci\u00f3n) FIWARE/credentials-config-service Keycloak Emisor de Verifiable Credentials en el lado del consumidor y proveedor de identidad (IdP) basado en OIDC/OAuth2. Issuer keycloak.org Scorpio (Orion-LD) Context Broker encargado de la gesti\u00f3n sem\u00e1ntica de datos mediante NGSI-LD. Context Broker ScorpioBroker trusted-issuers-list Act\u00faa como Trusted Issuers List, ofreciendo una API compatible con el registro de emisores de confianza (EBSI Trusted Issuers Registry API). Lista local de emisores de confianza FIWARE/trusted-issuers-list APISIX Pasarela API (API Gateway) que funciona como PEP (Policy Enforcement Point) e integra un plugin de OPA para control de acceso. PEP apisix.apache.org / plugin OPA OPA (Open Policy Agent) Motor de pol\u00edticas que act\u00faa como PDP (Policy Decision Point) en el sidecar del API Gateway. Eval\u00faa las pol\u00edticas de autorizaci\u00f3n. PDP openpolicyagent.org odrl-pap Permite configurar pol\u00edticas ODRL que ser\u00e1n utilizadas por OPA para la autorizaci\u00f3n. PRP/PAP (autorizaci\u00f3n) wistefan/odrl-pap tmforum-api Implementaci\u00f3n de las APIs de TM Forum para la gesti\u00f3n de contratos, ofertas y productos. Gesti\u00f3n de contratos FIWARE/tmforum-api contract-management Servicio de escucha y notificaci\u00f3n de eventos relacionados con la gesti\u00f3n de contratos provenientes de TM Forum. Gesti\u00f3n de contratos FIWARE/contract-management MySQL Base de datos relacional utilizada para almacenamiento estructurado de configuraciones o contratos. Base de datos mysql.com PostgreSQL Base de datos relacional avanzada para almacenamiento estructurado. Base de datos postgresql.org PostGIS Extensi\u00f3n espacial de PostgreSQL que a\u00f1ade soporte geoespacial y consultas sobre datos geogr\u00e1ficos. Base de datos postgis.net"},{"location":"stack/#apis-principales","title":"APIs principales","text":"API Rol Responsabilidad Ejemplos de Endpoints Data API Gesti\u00f3n de data assets (recursos reales de datos). Registrar, exponer y servir datos compartidos dentro del Dataspace.Incluye:\u2022 Entidades NGSI-LD, datasets o flujos de datos.\u2022 Acceso a los endpoints reales.\u2022 CRUD de assets (crear, consultar, actualizar, eliminar).\u2022 Servicios de descubrimiento por ID o tipo de recurso. <code>/data/assets</code> \u2192 lista de datasets disponibles.<code>/data/entities</code> \u2192 acceso a datos NGSI-LD. Contract API Gesti\u00f3n de ofertas y contratos de uso de los datos. Orquestar el ciclo de vida de los data offerings desde su definici\u00f3n hasta la negociaci\u00f3n.Incluye:\u2022 ProductSpecification, ProductOffering y Agreement (TM Forum).\u2022 Registro de ofertas disponibles y condiciones.\u2022 Iniciar, aceptar o rechazar negociaciones.\u2022 Generar Data Agreements y vincularlos a Data Assets. <code>/contract/offerings</code> \u2192 lista de ofertas.<code>/contract/agreements</code> \u2192 contratos activos.<code>/contract/negotiations</code> \u2192 gesti\u00f3n de negociaciones. Authorization API Control de acceso y aplicaci\u00f3n de pol\u00edticas (OPA/PDP). Evaluar si una solicitud cumple las condiciones de seguridad y contrato.Incluye:\u2022 Integraci\u00f3n con OPA (Open Policy Agent).\u2022 Evaluaci\u00f3n de pol\u00edticas (PDP/PIP/PAP).\u2022 Validaci\u00f3n de tokens OIDC y claims.\u2022 Env\u00edo de decisiones \u201cpermit/deny\u201d a APISIX. <code>/authz/evaluate</code> \u2192 recibe token y contexto, devuelve permit/deny. Authentication API Identidad y emisi\u00f3n de tokens o credenciales. Gestionar la autenticaci\u00f3n de usuarios, aplicaciones o conectores.Incluye:\u2022 Integraci\u00f3n con Keycloak (OIDC, OAuth2).\u2022 Emisi\u00f3n y validaci\u00f3n de tokens JWT.\u2022 Verifiable Credentials (OID4VC).\u2022 Endpoints de login, refresh, revoke. <code>/authn/token</code> \u2192 login.<code>/authn/validate</code> \u2192 validar token."},{"location":"tmforum/","title":"TM Forum APIs","text":"<p>El dataspace utiliza las APIs est\u00e1ndar de TM Forum para la gesti\u00f3n de ofertas, contratos y cat\u00e1logos de productos. Estas APIs permiten registrar especificaciones, ofertas y \u00f3rdenes de producto, adem\u00e1s de organizaciones y clientes.</p> <p>En esta secci\u00f3n se muestran los ejemplos m\u00e1s comunes.</p>"},{"location":"tmforum/#crear-una-product-specification","title":"Crear una Product Specification","text":"<p>La Product Specification define las caracter\u00edsticas t\u00e9cnicas y pol\u00edticas que debe cumplir un producto o dataset publicado en el dataspace. Incluye informaci\u00f3n sobre credenciales requeridas y pol\u00edticas ODRL asociadas.</p> <pre><code>export PRODUCT_SPEC_FULL_ID=$(curl -X POST \\\n  http://tm-forum-api.127.0.0.1.nip.io:8080/tmf-api/productCatalogManagement/v4/productSpecification \\\n  -H 'Content-Type: application/json;charset=utf-8' \\\n  -d \"{\n    \\\"brand\\\": \\\"M&amp;P Operations\\\",\n    \\\"version\\\": \\\"1.0.0\\\",\n    \\\"lifecycleStatus\\\": \\\"ACTIVE\\\",\n    \\\"name\\\": \\\"M&amp;P K8S\\\",\n    \\\"productSpecCharacteristic\\\": [\n      {\n        \\\"id\\\": \\\"credentialsConfig\\\",\n        \\\"name\\\": \\\"Credentials Config\\\",\n        \\\"@schemaLocation\\\": \\\"https://raw.githubusercontent.com/FIWARE/contract-management/refs/heads/main/schemas/credentials/credentialConfigCharacteristic.json\\\",\n        \\\"valueType\\\": \\\"credentialsConfiguration\\\",\n        \\\"productSpecCharacteristicValue\\\": [\n          {\n            \\\"isDefault\\\": true,\n            \\\"value\\\": {\n              \\\"credentialsType\\\": \\\"OperatorCredential\\\",\n              \\\"claims\\\": [\n                {\n                  \\\"name\\\": \\\"roles\\\",\n                  \\\"path\\\": \\\"$.roles[?(@.target==\\\\\\\"${PROVIDER_DID}\\\\\\\")].names[*]\\\",\n                  \\\"allowedValues\\\": [\\\"OPERATOR\\\"]\n                }\n              ]\n            }\n          }\n        ]\n      },\n      {\n        \\\"id\\\": \\\"policyConfig\\\",\n        \\\"name\\\": \\\"Policy for creation of K8S clusters.\\\",\n        \\\"@schemaLocation\\\": \\\"https://raw.githubusercontent.com/FIWARE/contract-management/refs/heads/policy-support/schemas/odrl/policyCharacteristic.json\\\",\n        \\\"valueType\\\": \\\"authorizationPolicy\\\",\n        \\\"productSpecCharacteristicValue\\\": [\n          {\n            \\\"isDefault\\\": true,\n            \\\"value\\\": {\n              \\\"@context\\\": {\\\"odrl\\\": \\\"http://www.w3.org/ns/odrl/2/\\\"},\n              \\\"@id\\\": \\\"https://mp-operation.org/policy/common/k8s-full\\\",\n              \\\"odrl:uid\\\": \\\"https://mp-operation.org/policy/common/k8s-full\\\",\n              \\\"@type\\\": \\\"odrl:Policy\\\",\n              \\\"odrl:permission\\\": {\n                \\\"odrl:assigner\\\": \\\"https://www.mp-operation.org/\\\",\n                \\\"odrl:target\\\": {\n                  \\\"@type\\\": \\\"odrl:AssetCollection\\\",\n                  \\\"odrl:source\\\": \\\"urn:asset\\\",\n                  \\\"odrl:refinement\\\": [{\n                    \\\"@type\\\": \\\"odrl:Constraint\\\",\n                    \\\"odrl:leftOperand\\\": \\\"ngsi-ld:entityType\\\",\n                    \\\"odrl:operator\\\": \\\"odrl:eq\\\",\n                    \\\"odrl:rightOperand\\\": \\\"K8SCluster\\\"\n                  }]\n                },\n                \\\"odrl:assignee\\\": {\n                  \\\"@type\\\": \\\"odrl:PartyCollection\\\",\n                  \\\"odrl:source\\\": \\\"urn:user\\\",\n                  \\\"odrl:refinement\\\": {\n                    \\\"@type\\\": \\\"odrl:LogicalConstraint\\\",\n                    \\\"odrl:and\\\": [\n                      {\n                        \\\"@type\\\": \\\"odrl:Constraint\\\",\n                        \\\"odrl:leftOperand\\\": \\\"vc:role\\\",\n                        \\\"odrl:operator\\\": \\\"odrl:hasPart\\\",\n                        \\\"odrl:rightOperand\\\": {\\\"@value\\\": \\\"OPERATOR\\\", \\\"@type\\\": \\\"xsd:string\\\"}\n                      },\n                      {\n                        \\\"@type\\\": \\\"odrl:Constraint\\\",\n                        \\\"odrl:leftOperand\\\": \\\"vc:type\\\",\n                        \\\"odrl:operator\\\": \\\"odrl:hasPart\\\",\n                        \\\"odrl:rightOperand\\\": {\\\"@value\\\": \\\"OperatorCredential\\\", \\\"@type\\\": \\\"xsd:string\\\"}\n                      }\n                    ]\n                  }\n                },\n                \\\"odrl:action\\\": \\\"odrl:use\\\"\n              }\n            }\n          }\n        ]\n      }\n    ]\n  }\" | jq -r '.id'); echo ${PRODUCT_SPEC_FULL_ID}\n</code></pre> <ul> <li> <p>Crea una Product Specification llamada M&amp;P K8S</p> </li> <li> <p>Un bloque de credenciales que exige OperatorCredential con rol OPERATOR.</p> </li> <li> <p>Una pol\u00edtica ODRL que limita su uso a entidades del tipo K8SCluster.</p> </li> <li> <p>Devuelve el identificador \u00fanico (PRODUCT_SPEC_FULL_ID) que se usar\u00e1 al crear las ofertas.</p> </li> </ul>"},{"location":"tmforum/#listar-especificaciones","title":"Listar especificaciones","text":"<pre><code>curl -X GET http://tm-forum-api.127.0.0.1.nip.io:8080/tmf-api/productCatalogManagement/v4/productSpecification \\\n  -H 'Accept: application/json'\n</code></pre>"},{"location":"tmforum/#crear-una-product-offering","title":"Crear una Product Offering","text":"<p>Una Product Offering representa una oferta comercial concreta basada en una especificaci\u00f3n previa. Puede haber m\u00faltiples ofertas con diferentes condiciones, precios o pol\u00edticas asociadas.</p> <pre><code>export PRODUCT_OFFERING_SMALL_ID=$(curl -X POST \\\n  http://tm-forum-api.127.0.0.1.nip.io:8080/tmf-api/productCatalogManagement/v4/productOffering \\\n  -H 'Content-Type: application/json;charset=utf-8' \\\n  -d \"{\n    \\\"version\\\": \\\"1.0.0\\\",\n    \\\"lifecycleStatus\\\": \\\"ACTIVE\\\",\n    \\\"name\\\": \\\"M&amp;P K8S Offering Small\\\",\n    \\\"productSpecification\\\": {\n      \\\"id\\\": \\\"${PRODUCT_SPEC_FULL_ID}\\\"\n    }\n  }\" | jq -r '.id'); echo ${PRODUCT_OFFERING_SMALL_ID}\n</code></pre> <ul> <li> <p>Crea una Product Offering basada en la Product Specification anterior.</p> </li> <li> <p>La asocia con el cat\u00e1logo gestionado por el nodo provider.</p> </li> <li> <p>Devuelve el ID de la nueva oferta.</p> </li> </ul>"},{"location":"tmforum/#listar-ofertas","title":"Listar ofertas","text":"<pre><code>curl -X GET http://tm-forum-api.127.0.0.1.nip.io:8080/tmf-api/productCatalogManagement/v4/productOffering \\\n  -H 'Accept: application/json'\n</code></pre>"},{"location":"tmforum/#registrar-una-organizacion-organization","title":"Registrar una organizaci\u00f3n (Organization)","text":"<p>Antes de poder realizar pedidos o firmar contratos, una organizaci\u00f3n consumidora debe registrarse en el conector del proveedor. Esto se realiza mediante la API Party Management de TM Forum (<code>/tmf-api/party/v4/organization</code>).</p> <p>En este ejemplo, Fancy Marketplace se registra en M&amp;P Operations utilizando una credencial de tipo REPRESENTATIVE.</p> <pre><code>export FANCY_MARKETPLACE_ID=$(curl -X POST \\\n  http://mp-tmf-api.127.0.0.1.nip.io:8080/tmf-api/party/v4/organization \\\n  -H 'Accept: */*' \\\n  -H 'Content-Type: application/json' \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -d \"{\n    \\\"name\\\": \\\"Fancy Marketplace Inc.\\\",\n    \\\"partyCharacteristic\\\": [\n      {\n        \\\"name\\\": \\\"did\\\",\n        \\\"value\\\": \\\"${CONSUMER_DID}\\\"\n      }\n    ]\n  }\" | jq -r '.id'); echo ${FANCY_MARKETPLACE_ID}\n</code></pre> <ul> <li> <p>Crea una Organization con nombre Fancy Marketplace Inc..</p> </li> <li> <p>Incluye el identificador descentralizado (DID) del consumidor en partyCharacteristic.</p> </li> <li> <p>La organizaci\u00f3n queda registrada dentro del cat\u00e1logo del provider y podr\u00e1 realizar pedidos o firmar acuerdos.</p> </li> <li> <p>Devuelve el identificador \u00fanico de la organizaci\u00f3n (FANCY_MARKETPLACE_ID).</p> </li> </ul> <p>Una vez registrada la organizaci\u00f3n:</p> <ul> <li> <p>El representative puede crear Product Orders usando su FANCY_MARKETPLACE_ID.</p> </li> <li> <p>El conector del proveedor puede aplicar las pol\u00edticas ODRL que restringen qu\u00e9 roles (e.g. REPRESENTATIVE) pueden crear u ordenar productos.</p> </li> </ul>"},{"location":"tmforum/#consultar-organizaciones-registradas","title":"Consultar organizaciones registradas","text":"<pre><code>curl -X GET \\\n  http://mp-tmf-api.127.0.0.1.nip.io:8080/tmf-api/party/v4/organization \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -H 'Accept: application/json'\n</code></pre> <p>Devuelve una lista de todas las organizaciones registradas, incluyendo su id, name, y caracter\u00edsticas (partyCharacteristic).</p>"},{"location":"tmforum/#crear-y-completar-un-product-order","title":"Crear y completar un Product Order","text":"<p>Una vez registrada la organizaci\u00f3n y disponible una oferta (<code>Product Offering</code>), el consumidor puede aceptar la oferta creando un pedido (Product Order). Esto representa la firma de un acuerdo de uso de datos dentro del dataspace.</p>"},{"location":"tmforum/#paso-1-crear-el-pedido","title":"Paso 1. Crear el pedido","text":"<p>El consumidor (por ejemplo, Fancy Marketplace Inc.) crea un Product Order indicando la oferta (<code>OFFER_ID</code>) que desea contratar y el identificador de su organizaci\u00f3n (<code>FANCY_MARKETPLACE_ID</code>).</p> <pre><code>export ORDER_ID=$(curl -X POST \\\n  http://mp-tmf-api.127.0.0.1.nip.io:8080/tmf-api/productOrderingManagement/v4/productOrder \\\n  -H 'Accept: */*' \\\n  -H 'Content-Type: application/json' \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -d \"{\n    \\\"productOrderItem\\\": [\n      {\n        \\\"id\\\": \\\"random-order-id\\\",\n        \\\"action\\\": \\\"add\\\",\n        \\\"productOffering\\\": { \\\"id\\\": \\\"${OFFER_ID}\\\" }\n      }\n    ],\n    \\\"relatedParty\\\": [\n      { \\\"id\\\": \\\"${FANCY_MARKETPLACE_ID}\\\" }\n    ]\n  }\" | jq -r '.id'); echo ${ORDER_ID}\n</code></pre> <ul> <li> <p>Crea un Product Order asociado a la oferta seleccionada.</p> </li> <li> <p>El campo \"action\": \"add\" indica que se est\u00e1 solicitando la contrataci\u00f3n del producto.</p> </li> <li> <p>relatedParty vincula el pedido con la organizaci\u00f3n consumidora.</p> </li> <li> <p>Devuelve el identificador \u00fanico del pedido (ORDER_ID).</p> </li> </ul>"},{"location":"tmforum/#paso-2-completar-el-pedido","title":"Paso 2. Completar el pedido","text":"<p>Una vez procesado por el sistema del proveedor, el pedido debe marcarse como completado. Esto simula la confirmaci\u00f3n de que la organizaci\u00f3n tiene acceso al dataset o servicio adquirido.</p> <pre><code>curl -X PATCH \\\n  http://tm-forum-api.127.0.0.1.nip.io:8080/tmf-api/productOrderingManagement/v4/productOrder/${ORDER_ID} \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -H 'Accept: application/json;charset=utf-8' \\\n  -H 'Content-Type: application/json;charset=utf-8' \\\n  -d '{\n    \"state\": \"completed\"\n  }' | jq .\n</code></pre> <ul> <li> <p>Actualiza el estado del pedido a \"completed\".</p> </li> <li> <p>Representa la finalizaci\u00f3n de la negociaci\u00f3n o contrato.</p> </li> <li> <p>Una vez completado, se genera el Agreement que rige el acceso del consumidor a los activos de datos.</p> </li> </ul>"},{"location":"tmforum/#consultar-pedidos-activos","title":"Consultar pedidos activos","text":"<pre><code>curl -X GET \\\n  http://mp-tmf-api.127.0.0.1.nip.io:8080/tmf-api/productOrderingManagement/v4/productOrder \\\n  -H \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  -H 'Accept: application/json'\n</code></pre> <p>Todos los pedidos asociados al consumidor autenticado, junto con su estado (acknowledged, inProgress, completed, etc.).</p> <p>Resultado final:</p> <ul> <li> <p>El consumidor ha aceptado una oferta (Product Offering).</p> </li> <li> <p>El pedido ha sido procesado y completado.</p> </li> <li> <p>Se genera un Data Agreement que vincula las pol\u00edticas ODRL y permite el acceso controlado a los datos en el dataspace.</p> </li> </ul>"},{"location":"tokens/","title":"\ud83d\udd10 Tokens y credenciales","text":"<p>El dataspace utiliza OpenID for Verifiable Credentials (OID4VC) y OpenID for Verifiable Presentations (OID4VP) para autenticar a los participantes mediante credenciales verificables (VCs). A continuaci\u00f3n se muestra c\u00f3mo obtener una credencial verificable y un token OIDC para acceder a APIs protegidas.</p>"},{"location":"tokens/#1-obtener-una-credencial-verificable-oid4vc","title":"1. Obtener una credencial verificable (OID4VC)","text":""},{"location":"tokens/#paso-1-solicitar-un-access-token-inicial","title":"Paso 1: Solicitar un Access Token inicial","text":"<pre><code>export ACCESS_TOKEN=$(curl -s -k -x localhost:8888 -X POST \\\n  \"$ISSUER_URL/realms/test-realm/protocol/openid-connect/token\" \\\n  --header 'Content-Type: application/x-www-form-urlencoded' \\\n  --data grant_type=password \\\n  --data client_id=account-console \\\n  --data username=operator \\\n  --data password=test | jq -r '.access_token')\n</code></pre>"},{"location":"tokens/#paso-2-obtener-la-oferta-de-credencial-credential-offer-uri","title":"Paso 2: Obtener la oferta de credencial (Credential Offer URI)","text":"<pre><code>export OFFER_URI=$(curl -s -k -x localhost:8888 -X GET \\\n  \"$ISSUER_URL/realms/test-realm/protocol/oid4vc/credential-offer-uri?credential_configuration_id=operator_credential\" \\\n  --header \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  | jq -r '\"\\(.issuer)\\(.nonce)\"')\n</code></pre>"},{"location":"tokens/#paso-3-obtener-el-codigo-pre-autorizado","title":"Paso 3: Obtener el c\u00f3digo pre-autorizado","text":"<pre><code>export PRE_AUTHORIZED_CODE=$(curl -s -k -x localhost:8888 -X GET ${OFFER_URI} \\\n  --header \"Authorization: Bearer ${ACCESS_TOKEN}\" \\\n  | jq -r '.grants.\"urn:ietf:params:oauth:grant-type:pre-authorized_code\".\"pre-authorized_code\"')\n</code></pre>"},{"location":"tokens/#paso-4-intercambiar-el-codigo-por-un-credential-access-token","title":"Paso 4: Intercambiar el c\u00f3digo por un Credential Access Token","text":"<pre><code>export CREDENTIAL_ACCESS_TOKEN=$(curl -s -k -x localhost:8888 -X POST \\\n  \"$ISSUER_URL/realms/test-realm/protocol/openid-connect/token\" \\\n  --header 'Content-Type: application/x-www-form-urlencoded' \\\n  --data grant_type=urn:ietf:params:oauth:grant-type:pre-authorized_code \\\n  --data pre-authorized_code=${PRE_AUTHORIZED_CODE} | jq -r '.access_token')\n</code></pre>"},{"location":"tokens/#paso-5-solicitar-la-credencial-verificable-vc","title":"Paso 5: Solicitar la credencial verificable (VC)","text":"<pre><code>export VC_JWT=$(curl -s -k -x localhost:8888 -X POST \\\n  \"$ISSUER_URL/realms/test-realm/protocol/oid4vc/credential\" \\\n  --header \"Authorization: Bearer ${CREDENTIAL_ACCESS_TOKEN}\" \\\n  --header 'Content-Type: application/json' \\\n  --data '{\"credential_identifier\":\"operator_credential\", \"format\":\"jwt_vc\"}' \\\n  | jq -r '.credential')\n</code></pre>"},{"location":"tokens/#2-obtener-un-access-token-oid4vp","title":"2. Obtener un Access Token (OID4VP)","text":""},{"location":"tokens/#paso-1-obtener-el-endpoint-de-token","title":"Paso 1: Obtener el endpoint de token","text":"<pre><code>export TOKEN_ENDPOINT=$(curl -s -k -X GET \"$ISSUER_URL/.well-known/openid-configuration\" \\\n  | jq -r '.token_endpoint')\n</code></pre>"},{"location":"tokens/#paso-2-crear-una-verifiable-presentation-vp","title":"Paso 2: Crear una Verifiable Presentation (VP)","text":"<pre><code>export HOLDER_DID=$(cat cert/did.json | jq -r '.id')\n</code></pre> <pre><code>export VERIFIABLE_PRESENTATION=$(jq -nc \\\n  --arg vc \"$VC_JWT\" \\\n  --arg did \"$HOLDER_DID\" \\\n  '{ \"@context\": [\"https://www.w3.org/2018/credentials/v1\"],\n     \"type\": [\"VerifiablePresentation\"],\n     \"verifiableCredential\": [$vc],\n     \"holder\": $did }')\n</code></pre>"},{"location":"tokens/#paso-3-construir-y-firmar-el-jwt-es256","title":"Paso 3: Construir y firmar el JWT (ES256)","text":"<pre><code>header=$(jq -nc --arg kid \"$HOLDER_DID\" '{alg:\"ES256\", typ:\"JWT\", kid:$kid}')\npayload=$(jq -nc --arg iss \"$HOLDER_DID\" --arg sub \"$HOLDER_DID\" \\\n  --argjson vp \"$VERIFIABLE_PRESENTATION\" '{iss:$iss, sub:$sub, vp:$vp}')\n\nheader_b64=$(echo -n \"$header\" | openssl base64 -A | tr '+/' '-_' | tr -d '=')\npayload_b64=$(echo -n \"$payload\" | openssl base64 -A | tr '+/' '-_' | tr -d '=')\nsigning_input=\"${header_b64}.${payload_b64}\"\nsignature_b64=$(echo -n \"$signing_input\" | openssl dgst -sha256 -binary -sign cert/private-key.pem | openssl base64 -A | tr '+/' '-_' | tr -d '=')\n\nexport JWT=\"${signing_input}.${signature_b64}\"\n\n</code></pre>"},{"location":"tokens/#paso-4-solicitar-el-access-token","title":"Paso 4: Solicitar el Access Token","text":"<pre><code>export ACCESS_TOKEN=$(curl -s -k -x localhost:8888 -X POST ${TOKEN_ENDPOINT} \\\n  --header 'Content-Type: application/x-www-form-urlencoded' \\\n  --data grant_type=vp_token \\\n  --data vp_token=${JWT} \\\n  --data scope=operator | jq -r '.access_token')\n</code></pre> <p>El resultado es una credencial verificable (VC) emitida por el Issuer y un Access Token OIDC derivado de ella, que se puede usar para acceder a endpoints protegidos por APISIX.</p>"}]}